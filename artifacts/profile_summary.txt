Профилирование profile_target (release, aarch64-apple-darwin)
==============================================================

Инструмент: xctrace / Instruments CPU Profiler
Бинарь: target/release/profile_target
Сэмплов всего: 107
Все сэмплы в состоянии Running — приложение полностью CPU-bound.

Горячие точки
--------------

#1  slow_dedup (включая вызовы из неё)       ~64% процессорных циклов
    - hashbrown::HashMap::insert             ~52%
    - сам slow_dedup (цикл, push в vec)      ~9%
    - core::slice::sort::unstable::ipnsort   ~3%

#2  sum_even                                  ~10%

#3  Создание потоков (race_increment)         ~15%
    20+ потоков, почти все сэмплы приходятся на thread_start/pthread

#4  Загрузка бинаря (dyld)                   ~3%

Что не попало в сэмплы (слишком быстро отработали):
  slow_fib, leak_buffer, normalize

Хронология (примерная)
-----------------------
 00:00.849-850   загрузка (dyld)
 00:00.851-853   sum_even, ~10 сэмплов
 00:00.854-879   slow_dedup, ~62 сэмпла (в основном HashMap::insert)
 00:00.879-882   race_increment, спавн потоков

Выводы
-------
Главный bottleneck — slow_dedup, забирает 64% времени.
Почти всё уходит в insert'ы в HashMap.
Оптимизация: HashSet с предвыделённой ёмкостью + одна сортировка в конце.

sum_even — вторая по весу функция (~10%), но тут особо нечего ускорять
(идиоматичный итератор, дальше только SIMD).

slow_fib после перевода на итерацию настолько быстр что не ловится сэмплером.

Полный файл Instruments: artifacts/profile.trace
